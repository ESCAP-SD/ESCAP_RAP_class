<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Serge Goussev">
<meta name="dcterms.date" content="2024-09-18">

<title>Web scraping example – ESCAP training on RAP</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../docs/scraper_docs.html" rel="next">
<link href="../docs/applying_rap/process-mapping.html" rel="prev">
<link href="../docs/images/favicon.drawio.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../docs/styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../docs/applying_rap/process-mapping.html">Applying RAP for price statistics</a></li><li class="breadcrumb-item"><a href="../notebooks/scraping_experiment.html">Web scraping example</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="https://sergegoussev.github.io/ESCAP_RAP_class/docs/" class="sidebar-logo-link">
      <img src="../docs/images/logo.drawio.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../docs/teaching_materials/teaching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ESCAP sesions on RAP</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/teaching_materials/sept_11/sept_11_session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 1: Introduction to RAP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/teaching_materials/sept_18/sept_18_session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 2: Deeper dive into key components</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../docs/applying_rap/process-mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Applying RAP for price statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/scraping_experiment.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Web scraping example</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../docs/scraper_docs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demo RAP scraper documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/scraper_docs/mapping_the_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mapping the process</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/scraper_docs/modularity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview of modules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/scraper_docs/error_handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Error handling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/scraper_docs/logging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logging</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/scraper_docs/output_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Output Data</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#can-we-scrape-at-all" id="toc-can-we-scrape-at-all" class="nav-link" data-scroll-target="#can-we-scrape-at-all">Can we scrape at all?</a></li>
  </ul></li>
  <li><a href="#explore-the-site" id="toc-explore-the-site" class="nav-link" data-scroll-target="#explore-the-site">Explore the site</a>
  <ul class="collapse">
  <li><a href="#navigation-and-how-to-get-the-data" id="toc-navigation-and-how-to-get-the-data" class="nav-link" data-scroll-target="#navigation-and-how-to-get-the-data">Navigation and how to get the data</a>
  <ul class="collapse">
  <li><a href="#single-shot-approach-and-pagination" id="toc-single-shot-approach-and-pagination" class="nav-link" data-scroll-target="#single-shot-approach-and-pagination">Single-shot approach and pagination</a></li>
  <li><a href="#category-by-category-approach" id="toc-category-by-category-approach" class="nav-link" data-scroll-target="#category-by-category-approach">Category-by-category approach</a></li>
  <li><a href="#which-way-should-we-go" id="toc-which-way-should-we-go" class="nav-link" data-scroll-target="#which-way-should-we-go">Which way should we go?</a></li>
  </ul></li>
  <li><a href="#scraping-info-on-each-individual-book-page" id="toc-scraping-info-on-each-individual-book-page" class="nav-link" data-scroll-target="#scraping-info-on-each-individual-book-page">Scraping info on each individual book page</a></li>
  </ul></li>
  <li><a href="#exploring-how-to-scrape-the-site" id="toc-exploring-how-to-scrape-the-site" class="nav-link" data-scroll-target="#exploring-how-to-scrape-the-site">Exploring how to scrape the site</a>
  <ul class="collapse">
  <li><a href="#scraping-categories" id="toc-scraping-categories" class="nav-link" data-scroll-target="#scraping-categories">Scraping categories</a></li>
  <li><a href="#navigate-all-pages-and-save-the-product-book" id="toc-navigate-all-pages-and-save-the-product-book" class="nav-link" data-scroll-target="#navigate-all-pages-and-save-the-product-book">Navigate all pages and save the product (book)</a>
  <ul class="collapse">
  <li><a href="#finding-out-the-product-url-so-that-we-can-go-there-later" id="toc-finding-out-the-product-url-so-that-we-can-go-there-later" class="nav-link" data-scroll-target="#finding-out-the-product-url-so-that-we-can-go-there-later">Finding out the product URL so that we can go there later</a></li>
  <li><a href="#finding-the-number-of-pages-to-go-through" id="toc-finding-the-number-of-pages-to-go-through" class="nav-link" data-scroll-target="#finding-the-number-of-pages-to-go-through">Finding the number of pages to go through</a></li>
  <li><a href="#putting-this-all-together-to-scrape-the-whole-category" id="toc-putting-this-all-together-to-scrape-the-whole-category" class="nav-link" data-scroll-target="#putting-this-all-together-to-scrape-the-whole-category">Putting this all together to scrape the whole category</a></li>
  </ul></li>
  <li><a href="#scaping-the-individual-product-page" id="toc-scaping-the-individual-product-page" class="nav-link" data-scroll-target="#scaping-the-individual-product-page">Scaping the individual product page</a>
  <ul class="collapse">
  <li><a href="#get-product-i.e.-book-title" id="toc-get-product-i.e.-book-title" class="nav-link" data-scroll-target="#get-product-i.e.-book-title">Get product (i.e.&nbsp;book) title</a></li>
  <li><a href="#get-product-description" id="toc-get-product-description" class="nav-link" data-scroll-target="#get-product-description">Get Product description</a></li>
  <li><a href="#get-product-information" id="toc-get-product-information" class="nav-link" data-scroll-target="#get-product-information">Get product information</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#putting-it-all-together-scraping-the-whole-site" id="toc-putting-it-all-together-scraping-the-whole-site" class="nav-link" data-scroll-target="#putting-it-all-together-scraping-the-whole-site">Putting it all together: scraping the whole site</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/sergegoussev/ESCAP_RAP_class/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/sergegoussev/ESCAP_RAP_class/blob/main/notebooks/scraping_experiment.ipynb" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div><div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://proxyway.com/guides/best-websites-to-practice-your-web-scraping-skills"><i class="bi bi-link-45deg"></i>A blog listing some popular sites with which you can practice web scraping</a></li><li><a href="https://nhsdigital.github.io/rap-community-of-practice/implementing_RAP/notebooks_versus_ide_development/"><i class="bi bi-link-45deg"></i>NHS guide on notebooks versus using an IDE - as we are using a notebook to explore the site but the notebook is less applicable for production</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../docs/applying_rap/process-mapping.html">Applying RAP for price statistics</a></li><li class="breadcrumb-item"><a href="../notebooks/scraping_experiment.html">Web scraping example</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Web scraping example</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Serge Goussev </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 18, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<p>Similar to other examples that we had in the course - this notebook will demo how to scrape <a href="https://books.toscrape.com/index.html">Books to scrape</a> - a fictional demo site that shows book prices and is designed for teaching web scraping! As it looks like a retailer website!</p>
<section id="can-we-scrape-at-all" class="level2">
<h2 class="anchored" data-anchor-id="can-we-scrape-at-all">Can we scrape at all?</h2>
<p>Before staring out - we normally check whether we can scrape the site. To validate whether this site allows scraping - let’s check this as well. This way we also demonstrate common steps: * Firstly we can check <a href="https://books.toscrape.com/robots.txt">https://books.toscrape.com/robots.txt</a> for the site - which does not exist! * Secondly we check the Terms and Conditions on the site - however this site does not have anything. Searching the internet tells us that <a href="https://proxyway.com/guides/best-websites-to-practice-your-web-scraping-skills">this is a popular scraping sandbox for beginners</a>!</p>
<p>Thus we can proceed!</p>
<hr>
</section>
</section>
<section id="explore-the-site" class="level1">
<h1>Explore the site</h1>
<p>First off - lets import the necessary things into the notebook</p>
<div id="cell-2" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then let’s set up the user agent that will be set up with the scraper request. We can build off <a href="https://xtophe.notion.site/Web-Scraping-for-CPI-Training-c36b27c2ea6b4f02ad760069afaf6fb5">what we saw in Session 10 for inspiration</a>.</p>
<div id="cell-4" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>heads <span class="op">=</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'User-Agent'</span>:<span class="st">'ESCAP Webscraping RAP demo scraper 1.0'</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'email'</span>: <span class="st">'goussev.serge@gmail.com'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Accept-Language'</span>: <span class="st">'en-US, en;q=0.5'</span>}</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> requests.Session()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="navigation-and-how-to-get-the-data" class="level2">
<h2 class="anchored" data-anchor-id="navigation-and-how-to-get-the-data">Navigation and how to get the data</h2>
<p>Firstly, using the developer mode in the browser, we see that there doesn’t seem to be an API behind this site as only the <code>html</code> is delivered. Thus we will need to use <code>BeautifulSoup</code> and scrape the full <code>html</code>.</p>
<p>To navigate the <code>html</code> aspect of the site, it looks like there are two ways we can do it:</p>
<section id="single-shot-approach-and-pagination" class="level3">
<h3 class="anchored" data-anchor-id="single-shot-approach-and-pagination">Single-shot approach and pagination</h3>
<p>It looks like off the bat, the site lists all books together with a <code>next</code> page at the bottom right.</p>
<p>When we start on page 1, within the html we see a <code>pager</code> class and <code>next</code> class within it:</p>
<p><img src="../docs/images/books_to_scrape_approach_page_1.png" alt="Alternative approach using navigation" style="box-shadow: 5px 5px 5px gray;" width="500"></p>
<p><img src="../docs/images/books_to_scrape_approach_pagination_html.png" alt="Alternative approach using navigation" style="box-shadow: 5px 5px 5px gray;" width="500"> <!-- 
![](../docs/images/books_to_scrape_approach_page_1.png)
![](../docs/images/books_to_scrape_approach_pagination_html.png) --></p>
<p>Once we get to the end, we see only a <code>previous</code> and the <code>next</code> class is no longer there</p>
<p><img src="../docs/images/books_to_scrape_pagination_last_page.png" alt="Alternative approach using navigation" style="box-shadow: 5px 5px 5px gray;" width="500"></p>
<p><img src="../docs/images/books_to_scrape_approach_pagination_html_last_page.png" alt="Alternative approach using navigation" style="box-shadow: 5px 5px 5px gray;" width="500"></p>
<!-- ![](../docs/images/books_to_scrape_pagination_last_page.png)
![](../docs/images/books_to_scrape_approach_pagination_html_last_page.png) -->
<p>The URL also starts behaves in a stable way, whether for all books or for a specific categories: * https://books.toscrape.com/catalogue/category/books_1/page-2.html * https://books.toscrape.com/catalogue/category/books/fantasy_19/page-2.html</p>
<p>This means that we can iterate through the pages quite easily. Since all the books are also available from the main page - we could just iterate through all 50 pages and get all 1000 books on the site.</p>
</section>
<section id="category-by-category-approach" class="level3">
<h3 class="anchored" data-anchor-id="category-by-category-approach">Category-by-category approach</h3>
<p>We can also navigate the category section on the left and then iterate through all the pages for the category:</p>
<p><img src="../docs/images/books_to_scrape_approach_2.png" alt="Alternative approach using navigation" style="box-shadow: 5px 5px 5px gray;" width="350"></p>
<!-- ![](../docs/images/books_to_scrape_approach_2.png) -->
<p>The html class for this is <code>side_categories</code> and we should easily be able to get into the unordered list and iterate through all of the categories:</p>
<p><img src="../docs/images/books_to_scrape_approach_2_html.png" alt="HTML listing the categories" style="box-shadow: 5px 5px 5px gray;" width="500"> <!-- ![](../docs/images/books_to_scrape_approach_2_html.png) --></p>
</section>
<section id="which-way-should-we-go" class="level3">
<h3 class="anchored" data-anchor-id="which-way-should-we-go">Which way should we go?</h3>
<p>As many retailer websites around the world NSOs will need to scrape will likely not get a single home page that lists all products - the more realistic scenario is to iterate first through each category, and then through each page on that category.</p>
</section>
</section>
<section id="scraping-info-on-each-individual-book-page" class="level2">
<h2 class="anchored" data-anchor-id="scraping-info-on-each-individual-book-page">Scraping info on each individual book page</h2>
<p>On each individual page, there are likely several categories that are of interest to us for consumer price statistics: * Product name * Product category * Product description * UPC * Final (post-tax) price * Whether the product is available or not</p>
<p><img src="../docs/images/books_to_scrape_individidual_page_info_of_interest.png" alt="HTML listing the categories" style="box-shadow: 5px 5px 5px gray;" width="800"></p>
<p>Below we will go through how to get all this information.</p>
</section>
</section>
<section id="exploring-how-to-scrape-the-site" class="level1">
<h1>Exploring how to scrape the site</h1>
<section id="scraping-categories" class="level2">
<h2 class="anchored" data-anchor-id="scraping-categories">Scraping categories</h2>
<div id="cell-7" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the URL</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>shop_url <span class="op">=</span> <span class="st">"https://books.toscrape.com/"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the with clause we learned about (could also be done directly) to collect and parse the site</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s.get(shop_url, headers<span class="op">=</span>heads) <span class="im">as</span> res:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> BeautifulSoup(res.text, <span class="st">"html.parser"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given the navigation we found previously (i.e.&nbsp;the <code>side_categories</code> div class), lets find all the categories:</p>
<div id="cell-9" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus just on the section we want</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>side_category_section <span class="op">=</span> response.find(<span class="st">"div"</span>, class_ <span class="op">=</span> <span class="st">"side_categories"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Isolate all the categories using the link tag as they will have a link</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> side_category_section.find_all(<span class="st">'a'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through all the categories and save the link in a dictionary key-value pair assigned</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># to the name of the category itself</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>dictionary_of_categories <span class="op">=</span> {}</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> categories:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    dictionary_of_categories[category.text.strip()] <span class="op">=</span> category.get(<span class="st">'href'</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Now lets see what we were able to scrape</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>dictionary_of_categories</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>{'Books': 'catalogue/category/books_1/index.html',
 'Travel': 'catalogue/category/books/travel_2/index.html',
 'Mystery': 'catalogue/category/books/mystery_3/index.html',
 'Historical Fiction': 'catalogue/category/books/historical-fiction_4/index.html',
 'Sequential Art': 'catalogue/category/books/sequential-art_5/index.html',
 'Classics': 'catalogue/category/books/classics_6/index.html',
 'Philosophy': 'catalogue/category/books/philosophy_7/index.html',
 'Romance': 'catalogue/category/books/romance_8/index.html',
 'Womens Fiction': 'catalogue/category/books/womens-fiction_9/index.html',
 'Fiction': 'catalogue/category/books/fiction_10/index.html',
 'Childrens': 'catalogue/category/books/childrens_11/index.html',
 'Religion': 'catalogue/category/books/religion_12/index.html',
 'Nonfiction': 'catalogue/category/books/nonfiction_13/index.html',
 'Music': 'catalogue/category/books/music_14/index.html',
 'Default': 'catalogue/category/books/default_15/index.html',
 'Science Fiction': 'catalogue/category/books/science-fiction_16/index.html',
 'Sports and Games': 'catalogue/category/books/sports-and-games_17/index.html',
 'Add a comment': 'catalogue/category/books/add-a-comment_18/index.html',
 'Fantasy': 'catalogue/category/books/fantasy_19/index.html',
 'New Adult': 'catalogue/category/books/new-adult_20/index.html',
 'Young Adult': 'catalogue/category/books/young-adult_21/index.html',
 'Science': 'catalogue/category/books/science_22/index.html',
 'Poetry': 'catalogue/category/books/poetry_23/index.html',
 'Paranormal': 'catalogue/category/books/paranormal_24/index.html',
 'Art': 'catalogue/category/books/art_25/index.html',
 'Psychology': 'catalogue/category/books/psychology_26/index.html',
 'Autobiography': 'catalogue/category/books/autobiography_27/index.html',
 'Parenting': 'catalogue/category/books/parenting_28/index.html',
 'Adult Fiction': 'catalogue/category/books/adult-fiction_29/index.html',
 'Humor': 'catalogue/category/books/humor_30/index.html',
 'Horror': 'catalogue/category/books/horror_31/index.html',
 'History': 'catalogue/category/books/history_32/index.html',
 'Food and Drink': 'catalogue/category/books/food-and-drink_33/index.html',
 'Christian Fiction': 'catalogue/category/books/christian-fiction_34/index.html',
 'Business': 'catalogue/category/books/business_35/index.html',
 'Biography': 'catalogue/category/books/biography_36/index.html',
 'Thriller': 'catalogue/category/books/thriller_37/index.html',
 'Contemporary': 'catalogue/category/books/contemporary_38/index.html',
 'Spirituality': 'catalogue/category/books/spirituality_39/index.html',
 'Academic': 'catalogue/category/books/academic_40/index.html',
 'Self Help': 'catalogue/category/books/self-help_41/index.html',
 'Historical': 'catalogue/category/books/historical_42/index.html',
 'Christian': 'catalogue/category/books/christian_43/index.html',
 'Suspense': 'catalogue/category/books/suspense_44/index.html',
 'Short Stories': 'catalogue/category/books/short-stories_45/index.html',
 'Novels': 'catalogue/category/books/novels_46/index.html',
 'Health': 'catalogue/category/books/health_47/index.html',
 'Politics': 'catalogue/category/books/politics_48/index.html',
 'Cultural': 'catalogue/category/books/cultural_49/index.html',
 'Erotica': 'catalogue/category/books/erotica_50/index.html',
 'Crime': 'catalogue/category/books/crime_51/index.html'}</code></pre>
</div>
</div>
<p>Fantastic! Appending each category to the site URL will give us a way how to navigate to the category!</p>
<p>We can also probably remove the <code>index.html</code> from the end of each as it is detrimental to the perfomance of the site.</p>
</section>
<section id="navigate-all-pages-and-save-the-product-book" class="level2">
<h2 class="anchored" data-anchor-id="navigate-all-pages-and-save-the-product-book">Navigate all pages and save the product (book)</h2>
<p>Lets say we want to focus on https://books.toscrape.com/catalogue/category/books/sequential-art_5/index.html. as there are 75 books to scrape within this category (others should look the same).</p>
<section id="finding-out-the-product-url-so-that-we-can-go-there-later" class="level3">
<h3 class="anchored" data-anchor-id="finding-out-the-product-url-so-that-we-can-go-there-later">Finding out the product URL so that we can go there later</h3>
<div id="cell-12" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scrape the main site URL + the category we want in the catalogue</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>category_url <span class="op">=</span> <span class="st">"catalogue/category/books/mystery_3/index.html"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s.get(shop_url <span class="op">+</span> category_url, headers<span class="op">=</span>heads) <span class="im">as</span> res:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> BeautifulSoup(res.text, <span class="st">"html.parser"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>products <span class="op">=</span> response.find_all(<span class="st">"article"</span>, class_<span class="op">=</span><span class="st">"product_pod"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the first link (which happens to be the picture), although we can get the second link too</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>products[<span class="dv">0</span>].find(<span class="st">'a'</span>).get(<span class="st">'href'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># as the full site per book is </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># https://books.toscrape.com/catalogue/scott-pilgrims-......html</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># we should thus strip ../../.. but keep the catalogue</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>shop_url<span class="op">+</span><span class="st">'catalogue'</span><span class="op">+</span>products[<span class="dv">0</span>].find(<span class="st">'a'</span>).get(<span class="st">'href'</span>)[<span class="dv">8</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>'https://books.toscrape.com/catalogue/sharp-objects_997/index.html'</code></pre>
</div>
</div>
<p>Perfect! So we now know all the URLs per product</p>
</section>
<section id="finding-the-number-of-pages-to-go-through" class="level3">
<h3 class="anchored" data-anchor-id="finding-the-number-of-pages-to-go-through">Finding the number of pages to go through</h3>
<p>Now we need to know how to iterate through pages</p>
<div id="cell-15" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># there is no 'number of pages' to check, but we can estimate the number from </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the amount of results at the top left of the page. For instance:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>response.find(<span class="st">"form"</span>, class_<span class="op">=</span><span class="st">"form-horizontal"</span>).text.strip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>'32 results - showing 1 to 20.'</code></pre>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># splitting with spaces and then extracting the first item in the list gets us the number by category</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>number_of_products <span class="op">=</span> response.find(<span class="st">"form"</span>, class_<span class="op">=</span><span class="st">"form-horizontal"</span>).text.strip().split(<span class="st">" "</span>)[<span class="dv">0</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#knowing that each page displays 20 products and rounding up gives us the number of pages</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">round</span>(<span class="bu">int</span>(number_of_products)<span class="op">/</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>2</code></pre>
</div>
</div>
</section>
<section id="putting-this-all-together-to-scrape-the-whole-category" class="level3">
<h3 class="anchored" data-anchor-id="putting-this-all-together-to-scrape-the-whole-category">Putting this all together to scrape the whole category</h3>
<div id="cell-18" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scrape the main site URL + the category we want in the catagory of interest</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>category_url <span class="op">=</span> <span class="st">"catalogue/category/books/historical-fiction_4/"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s.get(shop_url <span class="op">+</span> category_url, headers<span class="op">=</span>heads) <span class="im">as</span> res:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> BeautifulSoup(res.text, <span class="st">"html.parser"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create empty list to save URLs of each product/book to scrape into a list</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>products_to_scrape <span class="op">=</span> []</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the number of pages to iterate through:</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>number_of_products <span class="op">=</span> response.find(<span class="st">"form"</span>, class_<span class="op">=</span><span class="st">"form-horizontal"</span>).text.strip().split(<span class="st">" "</span>)[<span class="dv">0</span>]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate through the list of pages</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> page <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,math.ceil(<span class="bu">int</span>(number_of_products)<span class="op">/</span><span class="dv">20</span>)):</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># as we start off scraping the category site anyway, then we don't need to scrape it again</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># however if we are now on page 2, we haven't yet scraped it so we should</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> page <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        category_url <span class="op">=</span> category_url <span class="op">+</span> <span class="st">"page-</span><span class="sc">{}</span><span class="st">.html"</span>.<span class="bu">format</span>(page<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'getting'</span>,shop_url<span class="op">+</span>category_url)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> s.get(shop_url <span class="op">+</span> category_url, headers<span class="op">=</span>heads) <span class="im">as</span> res:</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> BeautifulSoup(res.text, <span class="st">"html.parser"</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all the product pods on this page</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    products <span class="op">=</span> response.find_all(<span class="st">"article"</span>, class_<span class="op">=</span><span class="st">"product_pod"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the first link (which happens to be the picture), although we can get the second link too</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product <span class="kw">in</span> products:</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        href <span class="op">=</span> product.find(<span class="st">'a'</span>).get(<span class="st">'href'</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        products_to_scrape.append(shop_url<span class="op">+</span><span class="st">'catalogue'</span><span class="op">+</span>product.find(<span class="st">'a'</span>).get(<span class="st">'href'</span>)[<span class="dv">8</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>getting https://books.toscrape.com/catalogue/category/books/historical-fiction_4/page-2.html</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the first 3 products</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>products_to_scrape[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>'https://books.toscrape.com/catalogue/the-house-by-the-lake_846/index.html'</code></pre>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Double check the number sraped</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(products_to_scrape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>26</code></pre>
</div>
</div>
<p>Perfect! As this page has 75 products/books - we scraped them all!</p>
</section>
</section>
<section id="scaping-the-individual-product-page" class="level2">
<h2 class="anchored" data-anchor-id="scaping-the-individual-product-page">Scaping the individual product page</h2>
<div id="cell-22" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scrape the main site URL + the category we want in the catagory of interest</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>category_url <span class="op">=</span> <span class="st">"catalogue/mesaerion-the-best-science-fiction-stories-1800-1849_983/index.html"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s.get(shop_url <span class="op">+</span> category_url, headers<span class="op">=</span>heads) <span class="im">as</span> res:</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> BeautifulSoup(res.text, <span class="st">"html.parser"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="get-product-i.e.-book-title" class="level3">
<h3 class="anchored" data-anchor-id="get-product-i.e.-book-title">Get product (i.e.&nbsp;book) title</h3>
<div id="cell-24" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get product/book name</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>response.title.text.split(<span class="st">"|"</span>)[<span class="dv">0</span>].strip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>'Mesaerion: The Best Science Fiction Stories 1800-1849'</code></pre>
</div>
</div>
</section>
<section id="get-product-description" class="level3">
<h3 class="anchored" data-anchor-id="get-product-description">Get Product description</h3>
<div id="cell-26" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># description is challenging as it has no unique id or class, thus we could</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># find the product description tab (which is the first sub-header class) and</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `find_next()` method to get to the description</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.find_all(<span class="st">"div"</span>, class_<span class="op">=</span><span class="st">"sub-header"</span>)[<span class="dv">0</span>].find_next(<span class="st">'p'</span>).text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Andrew Barger, award-winning author and engineer, has extensively researched forgotten journals and magazines of the early 19th century to locate groundbreaking science fiction short stories in the English language. In doing so, he found what is possibly the first science fiction story by a female (and it is not from Mary Shelley). Andrew located the first steampunk short Andrew Barger, award-winning author and engineer, has extensively researched forgotten journals and magazines of the early 19th century to locate groundbreaking science fiction short stories in the English language. In doing so, he found what is possibly the first science fiction story by a female (and it is not from Mary Shelley). Andrew located the first steampunk short story, which has not been republished since 1844. There is the first voyage to the moon in a balloon, republished for the first time since 1820 that further tells of a darkness machine and a lunarian named Zuloc. Other sci-stories include the first robotic insect and an electricity gun. Once again, Andrew has searched old texts to find the very best science fiction stories from the period when the genre automated to life, some of the stories are published for the first time in nearly 200 years. Read these fantastic stories today!OUR OWN COUNTRY So mechanical has the age become, that men seriously talk of flying machines, to go by steam, --not your air-balloons, but real Daedalian wings, made of wood and joints, nailed to your shoulder, --not wings of feathers and wax like the wings of Icarus, who fell into the Cretan sea, but real, solid, substantial, rock-maple wings with wrought-iron hinges, and huge concavities, to propel us through the air. Knickerbocker Magazine, May 18 ...more</code></pre>
</div>
</div>
</section>
<section id="get-product-information" class="level3">
<h3 class="anchored" data-anchor-id="get-product-information">Get product information</h3>
<p>As this is a table, there are 2 ways of getting this information, via <code>BeautifulSoup</code> and via <code>pandas</code>:</p>
<p><strong><code>BeautifulSoup</code> approach</strong></p>
<div id="cell-28" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the table into a dictionary</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>product_info <span class="op">=</span> {}</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to the product page</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>product_page <span class="op">=</span> response.find(<span class="st">"article"</span>, class_<span class="op">=</span><span class="st">"product_page"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># as this is the only table with rows, we can just get find all rows on the product page</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> product_page.find_all(<span class="st">'tr'</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> rows:</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># focus on each row's cells and then save the values</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    cells <span class="op">=</span> row.find_all([<span class="st">'th'</span>, <span class="st">'td'</span>])</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    product_info[cells[<span class="dv">0</span>].text] <span class="op">=</span> cells[<span class="dv">1</span>].text</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at what we saved</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>product_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>{'UPC': 'e30f54cea9b38190',
 'Product Type': 'Books',
 'Price (excl. tax)': 'Â£37.59',
 'Price (incl. tax)': 'Â£37.59',
 'Tax': 'Â£0.00',
 'Availability': 'In stock (19 available)',
 'Number of reviews': '0'}</code></pre>
</div>
</div>
<p><strong><code>pandas</code> approach</strong></p>
<div id="cell-30" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>all_tables <span class="op">=</span> pd.read_html(shop_url <span class="op">+</span> category_url)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>all_tables[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>UPC</td>
<td>e30f54cea9b38190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Product Type</td>
<td>Books</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Price (excl. tax)</td>
<td>£37.59</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Price (incl. tax)</td>
<td>£37.59</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Tax</td>
<td>£0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Availability</td>
<td>In stock (19 available)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Number of reviews</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can convert this to a dictionary by first setting the first </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># column as the index and second by telling pandas to convert it to a dictionary</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>all_tables[<span class="dv">0</span>].set_index(<span class="dv">0</span>).to_dict()[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>{'UPC': 'e30f54cea9b38190',
 'Product Type': 'Books',
 'Price (excl. tax)': '£37.59',
 'Price (incl. tax)': '£37.59',
 'Tax': '£0.00',
 'Availability': 'In stock (19 available)',
 'Number of reviews': '0'}</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="putting-it-all-together-scraping-the-whole-site" class="level1">
<h1>Putting it all together: scraping the whole site</h1>
<p>Now that we’ve explored it all - we can put it together and create a scraper for the whole site!</p>
<p>However instead of trying to do everything in one long script, lets at least break it out into two jobs: 1. a script that checks the entire site and saves the URLs of each product that needs to be scraped, and 2. a script that uses the URL of the product by getting all product characteristics that need saving - and this we already did above!</p>
<p>Thus #1 is the main thing that we need to do - i.e.&nbsp;find all the product URLs</p>
<div id="cell-33" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the URL</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>shop_url <span class="op">=</span> <span class="st">"https://books.toscrape.com/"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the with clause we learned about (could also be done directly) to </span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># collect and parse the site</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s.get(shop_url, headers<span class="op">=</span>heads) <span class="im">as</span> res:</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> BeautifulSoup(res.text, <span class="st">"html.parser"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all categories</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>side_category_section <span class="op">=</span> response.find(<span class="st">"div"</span>, class_ <span class="op">=</span> <span class="st">"side_categories"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Isolate all the categories using the link tag as they will have a link</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>categories_found <span class="op">=</span> side_category_section.find_all(<span class="st">'a'</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through all the categories and inside each through each page</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># to save the link of the product in a dictionary</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>dictionary_of_products <span class="op">=</span> {}</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> categories <span class="kw">in</span> categories_found:</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Since the 'Books' category is a catch-all, we want to skip it</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> categories.text.strip() <span class="op">==</span> <span class="st">'Books'</span>:</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For the category, create a dictionary to nest that will save the relevant info</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    dictionary_of_products[categories.text.strip()] <span class="op">=</span> {}</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the URL of the category within this nested dictionary</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    dictionary_of_products[categories.text.strip()][<span class="st">'category_url'</span>] <span class="op">=</span> categories.get(<span class="st">'href'</span>)[:<span class="op">-</span><span class="dv">10</span>]</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># break</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initiate an empty list of urls to scrape for the category</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    products_to_scrape_list <span class="op">=</span> []</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, each_category <span class="kw">in</span> <span class="bu">enumerate</span>(categories):</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get the category page</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> s.get(shop_url <span class="op">+</span> categories.get(<span class="st">'href'</span>)[:<span class="op">-</span><span class="dv">10</span>], headers<span class="op">=</span>heads) <span class="im">as</span> res:</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> BeautifulSoup(res.text, <span class="st">"html.parser"</span>)</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find the number of pages to iterate through:</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>        number_of_products <span class="op">=</span> response.find(<span class="st">"form"</span>, class_<span class="op">=</span><span class="st">"form-horizontal"</span>).text.strip().split(<span class="st">" "</span>)[<span class="dv">0</span>]</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># iterate through the list of pages</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> page <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,math.ceil(<span class="bu">int</span>(number_of_products)<span class="op">/</span><span class="dv">20</span>)):</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># as we start off scraping the category site anyway, then we don't need to scrape it again</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># however if we are now on page 2, we haven't yet scraped it so we should</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> page <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>                category_url <span class="op">=</span> categories.get(<span class="st">'href'</span>)[:<span class="op">-</span><span class="dv">10</span>] <span class="op">+</span> <span class="st">"page-</span><span class="sc">{}</span><span class="st">.html"</span>.<span class="bu">format</span>(page<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> s.get(shop_url <span class="op">+</span> category_url, headers<span class="op">=</span>heads) <span class="im">as</span> res:</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>                    response <span class="op">=</span> BeautifulSoup(res.text, <span class="st">"html.parser"</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find all the product pods on this page</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>            products <span class="op">=</span> response.find_all(<span class="st">"article"</span>, class_<span class="op">=</span><span class="st">"product_pod"</span>)</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract the first link (which happens to be the picture), although we can get the second link too</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> product <span class="kw">in</span> products:</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>                href <span class="op">=</span> product.find(<span class="st">'a'</span>).get(<span class="st">'href'</span>)</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>                products_to_scrape_list.append(shop_url<span class="op">+</span><span class="st">'catalogue'</span><span class="op">+</span>product.find(<span class="st">'a'</span>).get(<span class="st">'href'</span>)[<span class="dv">8</span>:])</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Save the nominal number of products and the list of urls in the main dictionary</span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>        dictionary_of_products[categories.text.strip()][<span class="st">'nominal_number_of_products'</span>] <span class="op">=</span> number_of_products</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>        dictionary_of_products[categories.text.strip()][<span class="st">'products_to_scrape_list'</span>] <span class="op">=</span> products_to_scrape_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great, so we’ve scraped the entire site - and saved the list of products into a list by category - in a dictionary called <code>dictionary_of_products</code>. Let’s check if there were no mistakes and that we actually saved 1000 product URLs</p>
<div id="cell-35" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do a little counter - starting with zero</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># go through each category</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> dictionary_of_products:</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and add to the counter the number of products</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">+=</span> <span class="bu">len</span>(dictionary_of_products[category][<span class="st">'products_to_scrape_list'</span>])</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># now display the total</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>counter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>1000</code></pre>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lets see what it looks like for one category (as it would be really busy if we looked at a few)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>dictionary_of_products[<span class="st">'Travel'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>{'category_url': 'catalogue/category/books/travel_2/',
 'nominal_number_of_products': '11',
 'products_to_scrape_list': ['https://books.toscrape.com/catalogue/its-only-the-himalayas_981/index.html',
  'https://books.toscrape.com/catalogue/full-moon-over-noahs-ark-an-odyssey-to-mount-ararat-and-beyond_811/index.html',
  'https://books.toscrape.com/catalogue/see-america-a-celebration-of-our-national-parks-treasured-sites_732/index.html',
  'https://books.toscrape.com/catalogue/vagabonding-an-uncommon-guide-to-the-art-of-long-term-world-travel_552/index.html',
  'https://books.toscrape.com/catalogue/under-the-tuscan-sun_504/index.html',
  'https://books.toscrape.com/catalogue/a-summer-in-europe_458/index.html',
  'https://books.toscrape.com/catalogue/the-great-railway-bazaar_446/index.html',
  'https://books.toscrape.com/catalogue/a-year-in-provence-provence-1_421/index.html',
  'https://books.toscrape.com/catalogue/the-road-to-little-dribbling-adventures-of-an-american-in-britain-notes-from-a-small-island-2_277/index.html',
  'https://books.toscrape.com/catalogue/neither-here-nor-there-travels-in-europe_198/index.html',
  'https://books.toscrape.com/catalogue/1000-places-to-see-before-you-die_1/index.html']}</code></pre>
</div>
</div>
<p>Perfect, the total is 1000, so we got all product URLs!</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>This notebook has demonstrated how to explore and parse the information on the site and get what we need. While we did not make a complex script that did everything all in one script, there is actually a very good reason – this script would be big, hard to code, hard to understand, and hard to debug as we’re likely to have mistakes. This would also make it a very RAP-unfriendly way to code. Thus we will see how the whole scraper can be developed to be more robust.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/sergegoussev\.github\.io\/ESCAP_RAP_class\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../docs/applying_rap/process-mapping.html" class="pagination-link" aria-label="Applying RAP for price statistics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Applying RAP for price statistics</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../docs/scraper_docs.html" class="pagination-link" aria-label="Demo RAP scraper documentation">
        <span class="nav-page-text">Demo RAP scraper documentation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2024, ESCAP</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sergegoussev/ESCAP_RAP_class/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/sergegoussev/ESCAP_RAP_class/blob/main/notebooks/scraping_experiment.ipynb" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sergegoussev/ESCAP_RAP_class">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://xtophe.notion.site/Web-Scraping-for-CPI-Training-c36b27c2ea6b4f02ad760069afaf6fb5">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>